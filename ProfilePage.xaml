<Page x:Class="Theater.ProfilePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Theater"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1050"
      Title="ProfilePage" Loaded="OnLoad">

    <Grid d:Background="#FF242740">
        <Grid.RowDefinitions>
            <RowDefinition Height="320"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <Border Margin="25" Style="{StaticResource CardBorder}" Width="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <Image Width="200" Height="200" Source="{Binding Path=currentUser.Image}">
                    <Image.Clip>
                        <RectangleGeometry Rect="0,0,200,200" RadiusX="125" RadiusY="125"/>
                    </Image.Clip>
                </Image>
                <StackPanel Grid.Column="1" Margin="10 0">
                    <TextBlock FontSize="32" Foreground="White" Text="{Binding Path=currentUser.Name}" TextWrapping="WrapWithOverflow"/>
                    <TextBlock FontSize="18" Foreground="LightSlateGray" Text="{Binding Path=currentUser.Email}"/>
                    <TextBlock FontSize="18" Foreground="Gray" Text="{Binding Path=currentUser.CreatedAtStr}"/>
                    <Button Style="{StaticResource Button}" Click="ExitFromAccount_Click" Foreground="Wheat" FontSize="18" Content="Выйти из аккаунта" HorizontalAlignment="Left"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Margin="10 0" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock FontSize="42" FontWeight="Bold" Foreground="Goldenrod" HorizontalAlignment="Center">
                        <Run Text="{Binding Path=currentUser.MoneySpend}"/>
                        <Run Text="₽"/>
                    </TextBlock>
                    <TextBlock FontSize="18" Foreground="LightSlateGray" Text="Всего потрачено" HorizontalAlignment="Center"/>
                    <TextBlock FontSize="42" FontWeight="Bold" Foreground="Goldenrod" Text="{Binding Path=currentUser.Tickets.Count}" HorizontalAlignment="Center"/>
                    <TextBlock FontSize="18" Foreground="LightSlateGray" Text="Куплено билетов" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <ScrollViewer Margin="12.5 0" Grid.Row="1" VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled" VerticalAlignment="Top">
            <ItemsControl ItemsSource="{Binding Path=currentUser.OrderViews}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource CardBorder}" Width="Auto" Height="200">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="180"/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>
                                <Image VerticalAlignment="Top" HorizontalAlignment="Left"
                                       Width="180" Height="180">
                                    <Image.Clip>
                                        <RectangleGeometry Rect="0,0,180,180" RadiusX="10" RadiusY="10"/>
                                    </Image.Clip>
                                </Image>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding Title}" FontSize="24" Foreground="White"/>
                                    <TextBlock Text="{Binding Date}" FontSize="20" Foreground="LightSlateGray"/>
                                    <TextBlock FontSize="20" Foreground="LightSlateGray">
                                        <Run Text="Зал: "/>
                                        <Run Text="{Binding Hall}"/>
                                    </TextBlock>
                                    <TextBlock TextWrapping="WrapWithOverflow" FontSize="20" TextTrimming="WordEllipsis" ToolTip="{Binding Seats}" Foreground="DimGray">
                                        <Run Text="Места: "/>
                                        <Run Text="{Binding Seats}"/>
                                    </TextBlock>
                                </StackPanel>

                                <Grid Grid.Column="2" Margin="0,0,10,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <StackPanel HorizontalAlignment="Right">
                                        <TextBlock FontSize="30" Foreground="Goldenrod" FontWeight="SemiBold" HorizontalAlignment="Right">
                                            <Run Text="{Binding Price}"/>
                                            <Run Text="₽"/>
                                        </TextBlock>
                                        <TextBlock Text="Итоговая цена" FontSize="20" Foreground="White" HorizontalAlignment="Right"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="1">
                                        <Button Style="{StaticResource BuyButton}"
Width="240" Height="60" Content="Перейти на страницу спектакля" Click="OpenPerformance_Click"/>
                                        <Button Grid.Column="1" Style="{StaticResource BuyButton}" Height="55" VerticalAlignment="Center" Padding="0" Margin="0"
                                                Click="ShowQr_Click">
                                            <StackPanel Orientation="Horizontal">
                                                <Label Content="Показать QR-код" VerticalAlignment="Center" FontSize="18" Foreground="Black"/>
                                                <Image Source="pack://Application:,,,/icons/qr-code.png" Height="20" Margin="10 0"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <Grid Grid.RowSpan="2" Visibility="Hidden" Background="Black" Opacity="0.6" x:Name="BlurGrid">
            <Grid.Effect>
                <BlurEffect KernelType="Gaussian" Radius="100" RenderingBias="Quality"/>
            </Grid.Effect>
        </Grid>
        <Border x:Name="QRGrid" Visibility="Hidden" Grid.RowSpan="2" VerticalAlignment="Center" HorizontalAlignment="Center"
                Style="{StaticResource CardBorder}" Height="650" Width="600" CornerRadius="25">
            <Grid>
                <Button Content="Закрыть" Style="{StaticResource BuyButton}" VerticalAlignment="Bottom"
                        HorizontalAlignment="Center" Height="60" Width="550" FontSize="24" Background="#FF383E6D"
                        Click="CloseQR_Click"/>
                <Image VerticalAlignment="Top" Margin="25" Source="{Binding QRcode}"/>
            </Grid>
        </Border>
    </Grid>
</Page>
